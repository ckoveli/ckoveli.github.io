"use strict";(self.webpackChunkdialgo=self.webpackChunkdialgo||[]).push([[175],{9175:function(t,e,n){n.r(e),n.d(e,{default:function(){return a}});var x=n(7294),O=n(5998),P=n(811),S=n(3211),E=n(2777),R=n(7904);function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||o(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var n,o=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)),o}function I(o){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){var e,n;e=o,n=r[t=t],(t=function(t){t=function(t,e){if("object"!==c(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===c(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(r,t))})}return o}function D(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,i,a=[],l=!0,u=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=c.call(n)).done)&&(a.push(o.value),a.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw r}}return a}}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){var n;if(t)return"string"==typeof t?r(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function a(t){function a(t){var e;"mousemove"===t.type&&t.preventDefault(),t=("touchmove"===t.type?(e=t.touches[0].clientX,t.touches[0]):(e=t.clientX,t)).clientY,v=k-e,w=j-t,k=e,j=t,m({position:{top:"".concat(p.current.offsetTop-w,"px"),left:"".concat(p.current.offsetLeft-v,"px")}})}var n=t.projects,e=t.setAlert,o=(0,O.I0)(),t=(0,O.v9)(function(t){return t.project}),r=t.modal,l=t.cursor,u=t.shape,c=t.projectIndex,s=n[c],t=D((0,x.useState)(null),2),f=t[0],i=t[1],t=D((0,x.useState)(null),2),h=t[0],d=t[1],p=(0,x.useRef)(null),b=(0,x.useRef)(null),y=(0,x.useRef)(null),m=function(t){o((0,P.j4)({index:c,project:I(I({},s),t)}))},g=20,v=((0,x.useEffect)(function(){/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&(y.current.style.display="none");var e=new E.fabric.Canvas(b.current,{width:b.current.clientWidth,height:b.current.clientHeight,backgroundColor:"white"});s.objects?s.objects.forEach(function(t){return e.add(t)}):m({objects:[]}),i(e)},[]),(0,x.useEffect)(function(){f&&o((0,P.ty)({previewImg:f.toDataURL()}))},["export"===r]),(0,x.useEffect)(function(){f&&("default"===(f.defaultCursor=l)?(f.selection=!0,f.getObjects().forEach(function(t){t.evented=!0})):(f.selection=!1,f.getObjects().forEach(function(t){t.evented=!1,t.selectable=!1})),f.setCursor(l),f.renderAll())},[l]),(0,x.useEffect)(function(){f&&(f.remove.apply(f,A(f.getObjects())),f.setDimensions({width:s.widthPx,height:s.heightPx}),s.objects?s.objects.forEach(function(t){return f.add(t)}):m({objects:[]}))},[c]),0),w=0,k=0,j=0;return s&&x.createElement(x.Fragment,null,x.createElement("div",{className:"canvas-wrapper",style:{cursor:l},onMouseDown:function(t){switch(t.preventDefault(),l){case"default":break;case"crosshair":var n,e=t,o=b.current.getBoundingClientRect(),r=!1,r=!0,c=e.clientX-o.left,i=e.clientY-o.top;switch(c/=s.scale,i/=s.scale,u){case"oval":n=new E.fabric.Ellipse({rx:0,ry:0,fill:"white",stroke:"black",strokeWidth:2,left:c,top:i,lockRotation:!0,hasRotatingPoint:!1});break;case"process":n=new E.fabric.Rect({width:0,height:0,fill:"white",stroke:"black",strokeWidth:2,left:c,top:i,lockRotation:!0,hasRotatingPoint:!1});break;case"decision":n=new E.fabric.Rect({width:0,height:0,fill:"white",stroke:"black",strokeWidth:2,left:c,top:i,angle:45,lockRotation:!0,hasRotatingPoint:!1});break;case"input":n=new E.fabric.Polygon([{x:0,y:0},{x:100,y:0},{x:70,y:50},{x:30,y:50}],{fill:"white",stroke:"black",strokeWidth:2,left:c,top:i,lockRotation:!0,hasRotatingPoint:!1});break;case"output":n=new E.fabric.Polygon([{x:0,y:0},{x:100,y:0},{x:70,y:-50},{x:30,y:-50}],{fill:"white",stroke:"black",strokeWidth:2,left:c,top:i,lockRotation:!0,hasRotatingPoint:!1});break;default:n=new E.fabric.Rect({width:0,height:0,fill:"white",stroke:"black",strokeWidth:2,left:c,top:i,lockRotation:!0,hasRotatingPoint:!1})}f.add(n),m({objects:[].concat(A(s.objects),[n])}),f.on("object:moving",function(t){t=t.target;t.set({left:Math.round(t.left/g)*g,top:Math.round(t.top/g)*g})}),f.on("object:scaling",function(t){var t=t.target,e=t.getScaledWidth(),n=t.getScaledHeight();0<g&&(e=Math.round(e/g)*g,n=Math.round(n/g)*g,t.set({scaleX:e/t.width,scaleY:n/t.height}))}),f.on("mouse:move",function(t){var e;r&&(e=t.e.clientX-o.left,t=t.e.clientY-o.top,e=e/s.scale,t=t/s.scale,e=e-c,t=t-i,"ellipse"===n.get("type")?n.set({rx:e,ry:t}):n.set({width:e,height:t}),f.renderAll())}),f.on("mouse:up",function(){r=!1,n=null});break;case"grab":k=t.clientX,j=t.clientY,document.onmouseup=function(){document.onmouseup=null,document.onmousemove=null},document.onmousemove=a;break;case"zoom-in":s.scale<=5&&m({scale:s.scale+.1});break;case"zoom-out":.1<=s.scale&&m({scale:s.scale-.1})}},onTouchStart:function(t){var e;2===t.touches.length&&(e=Math.hypot(t.touches[1].clientX-t.touches[0].clientX,t.touches[1].clientY-t.touches[0].clientY),d(e)),k=t.touches[0].clientX,j=t.touches[0].clientY,document.ontouchend=function(){document.ontouchend=null,document.ontouchmove=null},document.ontouchmove=a},onTouchMove:function(t){var e;t.preventDefault(),2===t.touches.length&&h&&(t=Math.hypot(t.touches[1].clientY=t.touches[0].clientX,t.touches[1].clientY-t.touches[0].clientY),function(t){throw new TypeError('"'+t+'" is read-only')}("distance"),e=s.scale+NaN,m({scale:e}),d(t))},onTouchEnd:function(){return d(null)},onDrop:function(t){t.preventDefault(),t=t.dataTransfer.files[0],(0,S.b)(t).then(function(e){var t;n.some(function(t){return t.id===e.data.id})?(t=n.findIndex(function(t){return t.id===e.data.id}),o((0,P.ty)({projectIndex:t}))):(o((0,P.B)(e.data)),o((0,P.ty)({projectIndex:n.length})))}).catch(function(t){e({message:t.message})})}},x.createElement("div",{ref:p,className:"fabric-wrapper",style:{top:s.position.top,left:s.position.left,scale:s.scale,transformOrigin:"0% 0%",width:s.width+s.unit,height:s.height+s.unit}},x.createElement("canvas",{ref:b,width:s.widthPx,height:s.heightPx,style:{backgroundImage:"radial-gradient(circle, black 1px, transparent 1px)",backgroundSize:"".concat(g,"px ").concat(g,"px")}}))),x.createElement("div",{ref:y,className:"slider"},x.createElement(R.II,{type:"range",min:.1,max:5,step:.1,value:s.scale,onChange:function(t){return m({scale:t.target.value})}})))}}}]);